# Prefect deployments configuration for Lemonade Data Ingestion Pipeline
name: lemonade-data-ingestion
prefect-version: 2.19.2

# Build section for Docker images (if needed)
build:

# Push section for remote storage
push:

# Pull section for cloning project
pull:

# Deployments section
deployments:
  # Files Ingestion Pipeline: Combined job with 3 dependent tasks
  - name: files_ingester
    version: 1
    tags: ['ingestion', 'spark', 'orchestrator', 'hourly']
    description: Combined pipeline with Task 1 (move files to processing), Task 2 (process all folders with Spark jobs), and Task 3 (cleanup)
    entrypoint: prefect_jobs/files_ingester/main.py:files_ingester_flow
    parameters: {}
    # For local execution - no work pool needed
    # In production: would use work_pool with Kubernetes/ECS
    work_pool:
      name: default-agent-pool
      work_queue_name: default
    schedules:
      - cron: '0 * * * *'  # Every hour at :00
        timezone: UTC
        day_or: true
        active: true

  # Daily Prefect Job: Summary Table Creation
  - name: daily_summary
    version: 1
    tags: ['aggregation', 'summary', 'daily', 'iceberg']
    description: Creates daily summary table using Spark aggregation with vehicle_id, day, last_event_time, last_event_type
    entrypoint: prefect_jobs/daily_summary/main.py:daily_summary_aggregation_flow
    parameters: {}
    # For local execution - no work pool needed
    # In production: would use work_pool with Kubernetes/ECS
    work_pool:
      name: default-agent-pool
      work_queue_name: default
    schedules:
      - cron: '0 1 * * *'  # Daily at 1 AM UTC
        timezone: UTC
        day_or: true
        active: true

